{% assign order_name = order.name %}
{% assign total_order_discount_amount = order.total_discounts | times: 100 %}

{% assign shipping_price = order.total_shipping_price_set.shop_money.amount | times: 100 %}
{% assign shipping_amount = order.total_shipping_price_set.shop_money.amount | times: 100 %}

{% assign subtotal_price = order.subtotal_price | times: 100 %}

{% comment %}
  TODO - impelement transaction.payment_details
{% endcomment %}
{% capture transactions_json %}
[
  {
    "status": "success",
    "kind": "sale",
    "amount": {{ order.current_total_price | times: 100 }}
  }
] 
{% endcapture %}
{% assign transactions = transactions_json | parse_json %}

{% comment %}
  TODO - not sure how original_line_price is defined
{% endcomment %}
{% capture subtotal_line_items_json %}
[
  {% for line_item in order.line_items %}
    {
      "id": "{{ line_item.id }}",
      "title": "{{ line_item.title }}",
      "quantity": {{ line_item.quantity }},
      "original_line_price": {{ line_item.price | times: line_item.quantity | times: 100 }},  
      "final_line_price": {{ line_item.price | times: line_item.quantity | times: 100 }}
    }
    {% unless forloop.last %},{% endunless %}
  {% endfor %}
]
{% endcapture %}
{% assign subtotal_line_items = subtotal_line_items_json | parse_json %}

{% assign billing_address = order.billing_address %}
{% assign tax_price = order.current_total_tax | times: 100 %}
{% assign company_location = order.company.location %}
{% assign po_number = order.po_number %}
{% assign order_status_url = order.order_status_url %}
{% assign discount_applications = order.discount_applications %}

{% assign total_tip = order.total_tip_received | plus: 0 %}
{% assign total_duties = order.current_total_duties_set.shop_money.amount  %}
{% assign payment_terms = order.payment_terms %}

{% assign requires_shipping = false %}
{% for line_item in order.line_items %}
  {% if line_item.requires_shipping %}
    {% assign requires_shipping = true %}
    {% break %}
  {% endif %}
{% endfor %}

{% capture shipping_address %}
  {{ order.shipping_address.first_name }} {{ order.shipping_address.last_name }}
  {{ order.shipping_address.address1 }}
  {{ order.shipping_address.address2 }}
  <br/>{{ order.shipping_address.city }}, {{ order.shipping_address.province_code }} {{ order.shipping_address.zip }}
  {{ order.shipping_address.country }}
{% endcapture %}

{% capture billing_address %}
  {{ order.billing_address.first_name }} {{ order.billing_address.last_name }}
  {{ order.billing_address.address1 }}
  {{ order.billing_address.address2 }}
  <br/>{{ order.billing_address.city }}, {{ order.billing_address.province_code }} {{ order.billing_address.zip }}
  {{ order.billing_address.country }}
{% endcapture %}

{% comment %} TODO
{% assign due_at_date = 'TBD' %}
{% assign shipping_discount = 'TBD' %}
{% assign consolidated_estimated_delivery_time = 'TBD' %}
{% assign refund_method_title = 'TBD' %}
{% assign delivery_promise_branded_shipping_line = 'TBD' %}
{% endcomment %}
